<!doctype html>
<html lang="ar" dir="rtl"> 
 <head> 
  <meta charset="UTF-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <title>HOMOS Wallet</title> 
  <link rel="stylesheet" href="style.css"> 
 <style type="text/css" id="dcoder_stylesheet">body {
    background-color: #000;
    color: #fff;
    font-family: 'Cairo', sans-serif;
    text-align: center;
    padding: 20px;
    margin: 0;
}

input, button {
    margin: 10px;
    padding: 10px;
    width: 80%;
    max-width: 300px;
    border-radius: 8px;
    border: none;
    font-size: 16px;
}

input {
    background-color: #333;
    color: #fff;
}

button {
    background-color: #28a745;
    color: #fff;
    cursor: pointer;
    transition: background-color 0.3s;
}

button:hover {
    background-color: #218838;
}

.actions {
    margin: 20px 0;
}

.contact-us {
    margin-top: 30px;
}

#action-content {
    margin-top: 30px;
}

#login-container, #wallet-container {
    max-width: 400px;
    margin: auto;
}</style></head> 
 <body> 
  <div id="login-container"> 
   <h2>HOMOS Wallet </h2> 
   <input type="email" id="email" placeholder="البريد الإلكتروني"> 
   <input type="password" id="password" placeholder="كلمة المرور"> <button onclick="login()">تسجيل الدخول</button> <button onclick="forgotPassword()">نسيت كلمة المرور؟</button> 
  </div> 
  <div id="wallet-container" style="display: none;"> 
   <h2>مرحبا بيك في محفظة HOMOS</h2> 
   <p id="user-balance">رصيدك: 0 جنيه</p> 
   <div class="actions"> <button onclick="showDeposit()">إيداع</button> <button onclick="showWithdraw()">سحب</button> <button onclick="showTransfer()">تحويل</button> <button onclick="showAdmin()" id="admin-btn" style="display: none;">منطقة المدير</button> 
   </div> 
   <div class="contact-us"> <button onclick="showContactOptions()">تواصل معانا</button> 
   </div> 
   <div id="action-content"></div> 
  </div> 
  <script src="firebase-config.js"></script> 
  <script src="main.js"></script> 
 
<script type="text/javascript" id="dcoder_script">// حفظ المستخدم بعد تسجيل الدخول
firebase.auth().onAuthStateChanged(function(user) {
    if (user) {
        loadWallet(user);
    } else {
        document.getElementById('wallet-container').style.display = 'none';
        document.getElementById('login-container').style.display = 'block';
    }
});

// تسجيل الدخول
function login() {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    firebase.auth().signInWithEmailAndPassword(email, password)
        .then((userCredential) => {
            loadWallet(userCredential.user);
        })
        .catch((error) => {
            alert('فيه مشكلة في تسجيل الدخول: ' + error.message);
        });
}

// نسيت كلمة المرور
function forgotPassword() {
    const email = document.getElementById('email').value;
    if (!email) {
        alert('اكتب البريد الإلكتروني الأول.');
        return;
    }
    firebase.auth().sendPasswordResetEmail(email)
        .then(() => {
            alert('تم إرسال رابط استرجاع كلمة السر على بريدك.');
        })
        .catch((error) => {
            alert('فيه مشكلة: ' + error.message);
        });
}

// تحميل المحفظة بعد الدخول
function loadWallet(user) {
    document.getElementById('login-container').style.display = 'none';
    document.getElementById('wallet-container').style.display = 'block';
    if (user.email === "ahmedfouad01278837444@gmail.com") {
        document.getElementById('admin-btn').style.display = 'block';
    }

    firebase.database().ref('users/' + user.uid).once('value').then((snapshot) => {
        if (!snapshot.exists()) {
            firebase.database().ref('users/' + user.uid).set({
                email: user.email,
                balance: 0
            });
        }
        updateBalance(user.uid);
    });
}

// تحديث الرصيد
function updateBalance(uid) {
    firebase.database().ref('users/' + uid + '/balance').on('value', (snapshot) => {
        document.getElementById('user-balance').innerText = 'رصيدك: ' + (snapshot.val() || 0) + ' جنيه';
    });
}

// عرض الإيداع
function showDeposit() {
    document.getElementById('action-content').innerHTML = `
        <h3>عملية الإيداع</h3>
        <p>حول على الرقم التالي: <b>+201012265953</b> <button onclick="copyPhone()">نسخ</button></p>
        <input type="number" id="deposit-amount" placeholder="اكتب المبلغ">
        <input type="text" id="sender-number" placeholder="رقم الهاتف اللي حولت منه">
        <input type="file" id="transfer-proof">
        <button onclick="confirmDeposit()">تأكيد الإيداع</button>
    `;
}

// نسخ رقم الهاتف
function copyPhone() {
    navigator.clipboard.writeText("+201012265953");
    alert('تم نسخ الرقم.');
}

// تأكيد الإيداع
function confirmDeposit() {
    const amount = document.getElementById('deposit-amount').value;
    const sender = document.getElementById('sender-number').value;
    const user = firebase.auth().currentUser;
    if (!amount || !sender) {
        alert('املا كل البيانات.');
        return;
    }

    let message = `طلب إيداع:\nمبلغ: ${amount} جنيه\nرقم التحويل: ${sender}\nالإيميل: ${user.email}`;
    let url = `https://wa.me/201016553764?text=${encodeURIComponent(message)}`;
    window.open(url, '_blank');
    alert('تم إرسال طلبك، سيتم إضافة الرصيد بعد المراجعة.');
}

// عرض السحب
function showWithdraw() {
    document.getElementById('action-content').innerHTML = `
        <h3>عملية السحب</h3>
        <input type="number" id="withdraw-amount" placeholder="اكتب المبلغ">
        <input type="text" id="withdraw-number" placeholder="رقم الهاتف اللي هتحول عليه">
        <button onclick="confirmWithdraw()">تأكيد السحب</button>
    `;
}

// تأكيد السحب
function confirmWithdraw() {
    const amount = parseFloat(document.getElementById('withdraw-amount').value);
    const number = document.getElementById('withdraw-number').value;
    const user = firebase.auth().currentUser;

    if (!amount || !number) {
        alert('املا كل البيانات.');
        return;
    }

    let deducted = amount * 0.015;
    deducted = deducted < 3 ? 3 : deducted;
    let finalAmount = amount - deducted;

    firebase.database().ref('users/' + user.uid + '/balance').once('value').then(snapshot => {
        let balance = snapshot.val() || 0;
        if (balance < amount) {
            alert('رصيدك مش كافي.');
            return;
        }

        firebase.database().ref('users/' + user.uid).update({
            balance: balance - amount
        });

        let message = `طلب سحب:\nمبلغ: ${amount} جنيه\nبعد الخصم: ${finalAmount} جنيه\nرقم السحب: ${number}\nالإيميل: ${user.email}`;
        let url = `https://wa.me/201016553764?text=${encodeURIComponent(message)}`;
        window.open(url, '_blank');
        alert('تم إرسال طلب السحب.');
    });
}

// عرض التحويل
function showTransfer() {
    document.getElementById('action-content').innerHTML = `
        <h3>تحويل بين المستخدمين</h3>
        <input type="email" id="recipient-email" placeholder="ايميل المستلم">
        <input type="number" id="transfer-amount" placeholder="المبلغ">
        <button onclick="confirmTransfer()">تأكيد التحويل</button>
    `;
}

// تأكيد التحويل
function confirmTransfer() {
    const email = document.getElementById('recipient-email').value;
    const amount = parseFloat(document.getElementById('transfer-amount').value);
    const user = firebase.auth().currentUser;

    if (!email || !amount) {
        alert('املا كل البيانات.');
        return;
    }

    firebase.database().ref('users').orderByChild('email').equalTo(email).once('value').then(snapshot => {
        if (!snapshot.exists()) {
            alert('الايميل مش موجود.');
            return;
        }

        const recipientId = Object.keys(snapshot.val())[0];

        firebase.database().ref('users/' + user.uid + '/balance').once('value').then(userSnapshot => {
            let balance = userSnapshot.val() || 0;
            if (balance < (amount + 1)) {
                alert('رصيدك مش كافي.');
                return;
            }

            firebase.database().ref('users/' + user.uid).update({
                balance: balance - (amount + 1)
            });

            firebase.database().ref('users/' + recipientId).once('value').then(recipientSnapshot => {
                let recipientBalance = recipientSnapshot.val().balance || 0;
                firebase.database().ref('users/' + recipientId).update({
                    balance: recipientBalance + amount
                });

                alert('تم التحويل بنجاح.');
            });
        });
    });
}

// منطقة الأدمن
function showAdmin() {
    document.getElementById('action-content').innerHTML = `
        <h3>منطقة المدير</h3>
        <input type="email" id="user-email" placeholder="ايميل المستخدم">
        <input type="number" id="amount-to-add" placeholder="مبلغ الرصيد">
        <button onclick="addBalance()">إضافة رصيد</button>
    `;
}

// إضافة رصيد لمستخدم
function addBalance() {
    const email = document.getElementById('user-email').value;
    const amount = parseFloat(document.getElementById('amount-to-add').value);

    firebase.database().ref('users').orderByChild('email').equalTo(email).once('value').then(snapshot => {
        if (!snapshot.exists()) {
            alert('الايميل مش موجود.');
            return;
        }

        const userId = Object.keys(snapshot.val())[0];
        firebase.database().ref('users/' + userId + '/balance').once('value').then(balanceSnapshot => {
            let currentBalance = balanceSnapshot.val() || 0;
            firebase.database().ref('users/' + userId).update({
                balance: currentBalance + amount
            });

            alert('تم إضافة الرصيد.');
        });
    });
}

// زر التواصل معانا
function showContactOptions() {
    document.getElementById('action-content').innerHTML = `
        <h3>تواصل معانا</h3>
        <p><a href="mailto:homoswallet@gmail.com">راسلنا على الإيميل</a></p>
        <p><a href="tel:01014879247">اتصل بينا على المحمول</a></p>
        <p><a href="tel:0402403621">اتصل بالخط الأرضي</a></p>
        <p><a href="https://wa.me/201012265953" target="_blank">راسلنا على الواتساب</a></p>
    `;
}</script></body></html>