<!doctype html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HOMOS Wallet</title>
  <link rel="stylesheet" href="style.css">
<style type="text/css" id="dcoder_stylesheet">/* الأساسيات */ body { font-family: Arial, sans-serif; background-color: #000000; color: #ffffff; padding: 20px; box-sizing: border-box; }

/* رأس الصفحة */ header { display: flex; justify-content: space-between; align-items: center; background-color: #006400; padding: 10px 20px; color: white; border-radius: 10px; }

h1 { margin: 0; color: #00ff00; }

/* المدخلات والأزرار */ input, button { margin: 10px auto; padding: 12px; width: 100%; max-width: 100%; display: block; font-size: 16px; border-radius: 8px; box-sizing: border-box; }

input { background-color: #1c1c1c; color: white; border: 1px solid #00ff00; }

/* الأزرار */ button { background-color: #00ff00; color: black; border: none; cursor: pointer; transition: 0.3s; }

button:hover { background-color: #32cd32; }

/* النصوص الهامة */ h2, h3 { color: #00ff00; text-align: center; }

/* الروابط */ a { color: #00ff00; text-decoration: none; }

a:hover { text-decoration: underline; }

/* أقسام العمليات */ #operations-buttons button { margin: 10px 5px; display: inline-block; width: auto; padding: 10px 20px; background-color: #00ff00; color: black; border-radius: 6px; }

#users-list, #deposit-requests { margin-top: 20px; background-color: #121212; padding: 10px; border-radius: 10px; }

#users-list button, #deposit-requests button { margin: 5px 0; width: 100%; }

/* اخفاء أو إظهار الأقسام */ #deposit-section, #withdraw-section, #transfer-section, #support-section { margin-top: 20px; padding: 15px; background-color: #121212; border-radius: 10px; }

/* زر إخفاء الرصيد */ #toggle-balance { display: inline-block; margin-right: 10px; width: auto; font-size: 12px; padding: 5px 10px; background-color: #00ff00; color: black; }

/* آخر عملية */ #last-operation { margin-top: 5px; font-size: 14px; color: #aaa; text-align: center; }

/* صورة إثبات الدفع */ .deposit-proof-image { max-width: 100%; margin-top: 10px; border-radius: 6px; }

/* مربع الإيداع الفردي */ .deposit-box { background-color: #1c1c1c; padding: 10px; border-radius: 10px; margin-bottom: 15px; color: white; border: 1px solid #00ff00; }

.deposit-box button { width: 48%; display: inline-block; margin: 5px 1%; }

</style></head>
<body style="background-color: black; color: white;">
  <header>
    <h1>HOMOS Wallet</h1>
    <button onclick="logout()">تسجيل الخروج</button>
  </header>

  <main>
    <!-- تسجيل الدخول -->
    <div id="auth-section">
      <h2>تسجيل الدخول</h2>
      <input type="email" id="email" placeholder="البريد الإلكتروني">
      <input type="password" id="password" placeholder="كلمة المرور">
      <button onclick="login()">دخول</button>
      <button onclick="forgotPassword()">نسيت كلمة المرور؟</button>
      <p id="error-message"></p>
    </div>

    <!-- المحفظة -->
    <div id="wallet-section" style="display: none;">
      <h2>أهلاً بيك، <span id="user-email"></span></h2>
      <p>
        رصيدك الحالي: <span id="balance">0</span> جنيه
        <button id="toggle-balance" onclick="toggleBalance()">إخفاء</button>
      </p>
      <p id="last-operation"></p>

      <!-- أزرار العمليات -->
      <div id="operations-buttons">
        <button onclick="showSection('deposit-section')">إيداع رصيد</button>
        <button onclick="showSection('withdraw-section')">سحب رصيد</button>
        <button onclick="showSection('transfer-section')">تحويل رصيد</button>
        <button onclick="showSection('support-section')">الدعم الفني / حل المشكلات</button>
        <button onclick="showUserHistory()">عرض العمليات</button>
      </div>

      <!-- قسم الإيداع -->
      <div id="deposit-section" style="display: none;">
        <h3>إيداع رصيد</h3>
        <p>حول على الرقم: <span id="deposit-phone">01014879247</span>
          <button onclick="copyPhone()">نسخ الرقم</button>
        </p>
        <input type="number" id="deposit-amount" placeholder="اكتب المبلغ اللي حولته">
        <input type="text" id="sender-phone" placeholder="اكتب رقم الموبايل اللي حولت منه">
        <input type="file" id="deposit-proof" accept="image/*">
        <button onclick="confirmDeposit()">تأكيد الإيداع</button>
      </div>

      <!-- قسم السحب -->
      <div id="withdraw-section" style="display: none;">
        <h3>سحب رصيد</h3>
        <input type="text" id="withdraw-phone" placeholder="رقم الموبايل اللي هتسحب عليه">
        <input type="number" id="withdraw-amount" placeholder="المبلغ اللي عايز تسحبه">
        <button onclick="confirmWithdraw()">تأكيد السحب</button>
      </div>

      <!-- قسم التحويل -->
      <div id="transfer-section" style="display: none;">
        <h3>تحويل رصيد</h3>
        <input type="email" id="transfer-email" placeholder="البريد الإلكتروني للمستلم">
        <input type="number" id="transfer-amount" placeholder="المبلغ اللي عايز تحوله">
        <button onclick="confirmTransfer()">تأكيد التحويل</button>
      </div>

      <!-- قسم الدعم -->
      <div id="support-section" style="display: none;">
        <h3>الدعم الفني / حل المشكلات</h3>
        <p>البريد الإلكتروني:
          <a href="mailto:homoswallet@gmail.com" style="color: lightgreen;">homoswallet@gmail.com</a>
        </p>
        <p>واتساب:
          <a href="https://wa.me/201012265953" target="_blank" style="color: lightgreen;">+201012265953</a>
        </p>
        <p>رقم أرضي:
          <a href="tel:+20402403621" style="color: lightgreen;">+20402403621</a>
        </p>
        <p>رقم موبايل:
          <a href="tel:+201014879247" style="color: lightgreen;">+201014879247</a>
        </p>
      </div>

      <!-- قسم المدير -->
      <div id="admin-section" style="display: none;">
        <h3>لوحة تحكم المدير</h3>

        <input type="email" id="target-email" placeholder="بريد المستخدم">
        <input type="number" id="add-amount" placeholder="المبلغ اللي هتزوده">
        <button onclick="addBalance()">زود الرصيد</button>

        <h3>طلبات الإيداع:</h3>
        <div id="deposit-requests"></div>

        <h3>كل المستخدمين:</h3>
        <div id="users-list"></div>
      </div>
    </div>
  </main>

  <!-- مكتبات Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>
  <script src="app.js"></script>

<script type="text/javascript" id="dcoder_script">// تهيئة Firebase
const firebaseConfig = {
  apiKey: "AIzaSyCWyQfMmzp41jTYV4GXFViV2wMMTIiP8XU",
  authDomain: "wallet-52a17.firebaseapp.com",
  projectId: "wallet-52a17",
  storageBucket: "wallet-52a17.appspot.com",
  messagingSenderId: "440517088889",
  appId: "1:440517088889:web:a862ab37106851c66066a8",
  measurementId: "G-28Z0S2BGEV"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
const storage = firebase.storage();

let currentVisibleSection = null;
function showSection(sectionId) {
  if (currentVisibleSection === sectionId) {
    document.getElementById(sectionId).style.display = "none";
    currentVisibleSection = null;
  } else {
    ["deposit-section", "withdraw-section", "transfer-section", "support-section"].forEach(id => {
      document.getElementById(id).style.display = "none";
    });
    document.getElementById(sectionId).style.display = "block";
    currentVisibleSection = sectionId;
  }
}

let balanceVisible = true;
function toggleBalance() {
  const balanceEl = document.getElementById("balance");
  const toggleBtn = document.getElementById("toggle-balance");
  if (balanceVisible) {
    balanceEl.innerText = "•••••";
    toggleBtn.innerText = "إظهار";
  } else {
    const userEmail = auth.currentUser.email;
    db.collection("wallets").doc(userEmail).get().then(doc => {
      if (doc.exists) {
        balanceEl.innerText = doc.data().balance.toFixed(2);
      }
    });
    toggleBtn.innerText = "إخفاء";
  }
  balanceVisible = !balanceVisible;
}

function forgotPassword() {
  const email = document.getElementById("email").value.trim();
  if (!email) return alert("اكتب البريد الأول");
  auth.sendPasswordResetEmail(email)
    .then(() => alert("تم إرسال رابط تغيير كلمة المرور لبريدك"))
    .catch(err => alert("خطأ: " + err.message));
}

function login() {
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value.trim();
  if (!email.includes("@") || password.length < 6) {
    alert("اكتب بريد صحيح وكلمة مرور أكثر من 6 حروف");
    return;
  }
  auth.signInWithEmailAndPassword(email, password)
    .then(() => afterLogin(email))
    .catch((error) => {
      if (error.code === 'auth/user-not-found' || error.code === 'auth/invalid-login-credentials') {
        auth.createUserWithEmailAndPassword(email, password)
          .then(() => {
            alert("تم إنشاء حساب جديد!");
            afterLogin(email);
          })
          .catch((signupError) => {
            document.getElementById("error-message").innerText = "خطأ: " + signupError.message;
          });
      } else {
        document.getElementById("error-message").innerText = "خطأ: " + error.message;
      }
    });
}

function afterLogin(email) {
  document.getElementById("auth-section").style.display = "none";
  document.getElementById("wallet-section").style.display = "block";
  document.getElementById("user-email").innerText = email;

  if (email === "ahmedfouad01278837444@gmail.com") {
    document.getElementById("admin-section").style.display = "block";
    loadUsers();
    loadDeposits();
  }

  const userDoc = db.collection("wallets").doc(email);
  userDoc.get().then(doc => {
    if (!doc.exists) {
      userDoc.set({ balance: 0, history: [] });
    } else {
      const data = doc.data();
      document.getElementById("balance").innerText = data.balance.toFixed(2);
      if (data.history?.length) {
        const last = data.history[data.history.length - 1];
        document.getElementById("last-operation").innerText =
          `آخر عملية: ${last.type} - ${last.amount}ج - ${last.date.slice(0, 10)}`;
      }
    }
  });
}

auth.onAuthStateChanged(user => {
  if (user) afterLogin(user.email);
});

function logout() {
  auth.signOut().then(() => location.reload());
}

function copyPhone() {
  navigator.clipboard.writeText("01014879247");
  alert("تم نسخ الرقم!");
}

// حفظ الإيداع مع صورة
function confirmDeposit() {
  const amount = parseFloat(document.getElementById("deposit-amount").value);
  const senderPhone = document.getElementById("sender-phone").value.trim();
  const file = document.getElementById("deposit-proof").files[0];
  const userEmail = auth.currentUser.email;

  if (!amount || !senderPhone || !file) return alert("كل البيانات مطلوبة!");

  const fileRef = storage.ref().child(`proofs/${Date.now()}_${file.name}`);
  fileRef.put(file).then(snapshot => {
    snapshot.ref.getDownloadURL().then(imageURL => {
      db.collection("deposits").add({
        email: userEmail,
        amount,
        fromPhone: senderPhone,
        imageURL,
        date: new Date().toISOString(),
        status: "قيد المراجعة"
      }).then(() => {
        alert("تم إرسال بيانات الإيداع. هيراجعوها قريب.");
        document.getElementById("deposit-section").style.display = "none";
      });
    });
  });
}

// عرض طلبات الإيداع للمدير
function loadDeposits() {
  const container = document.getElementById("deposit-requests");
  container.innerHTML = "جاري التحميل...";
  db.collection("deposits").orderBy("date", "desc").get().then(snapshot => {
    container.innerHTML = "";
    snapshot.forEach(doc => {
      const data = doc.data();
      const box = document.createElement("div");
      box.className = "deposit-box";
      box.innerHTML = `
        <p>البريد: ${data.email}</p>
        <p>المبلغ: ${data.amount} جنيه</p>
        <p>رقم التحويل: ${data.fromPhone}</p>
        <p>الحالة: ${data.status}</p>
        <img src="${data.imageURL}" class="deposit-proof-image">
        <button onclick="approveDeposit('${doc.id}', ${data.amount}, '${data.email}')">اعتماد</button>
        <button onclick="rejectDeposit('${doc.id}')">رفض</button>
      `;
      container.appendChild(box);
    });
  });
}

function approveDeposit(docId, amount, email) {
  db.collection("wallets").doc(email).get().then(doc => {
    const exists = doc.exists;
    const update = exists ?
      db.collection("wallets").doc(email).update({
        balance: firebase.firestore.FieldValue.increment(amount),
        history: firebase.firestore.FieldValue.arrayUnion({
          type: "إيداع مؤكد",
          amount,
          date: new Date().toISOString()
        })
      }) :
      db.collection("wallets").doc(email).set({
        balance: amount,
        history: [{ type: "إيداع مؤكد", amount, date: new Date().toISOString() }]
      });

    update.then(() => {
      db.collection("deposits").doc(docId).update({ status: "تم الاعتماد" });
      alert("تم الاعتماد.");
      loadDeposits();
    });
  });
}

function rejectDeposit(docId) {
  db.collection("deposits").doc(docId).update({ status: "مرفوض" }).then(() => {
    alert("تم الرفض.");
    loadDeposits();
  });
}

// أكواد العمليات الأخرى تضاف لاحقاً:
function confirmWithdraw() {}
function confirmTransfer() {}
function addBalance() {}
function loadUsers() {}
function showUserHistory() {}</script></body></html>