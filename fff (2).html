<!doctype html>
<html lang="ar"> 
 <head> 
  <meta charset="UTF-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <title>HOMOS Wallet</title> 
  <link rel="stylesheet" href="style.css"> 
 <style type="text/css" id="dcoder_stylesheet">body {
  font-family: 'Cairo', sans-serif;
  background-color: black;
  color: white;
  margin: 0;
  padding: 0;
}

header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background-color: #1c1c1c;
  padding: 10px 20px;
}

.logo-container {
  display: flex;
  align-items: center;
  gap: 10px;
}

.logo-img {
  width: 40px;
  height: 40px;
}

input, select, button {
  display: block;
  margin: 10px auto;
  padding: 10px;
  border: none;
  border-radius: 8px;
  width: 90%;
  max-width: 300px;
}

button {
  background-color: #00cc00;
  color: white;
  cursor: pointer;
}

button:hover {
  background-color: #009900;
}

.operation-section {
  margin-top: 20px;
  border-top: 1px solid #333;
  padding-top: 10px;
}

#footer-marquee {
  position: fixed;
  bottom: 0;
  width: 100%;
  background-color: #1c1c1c;
  color: #00ff00;
  padding: 10px;
  font-size: 14px;
  z-index: 999;
}

.button-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
  gap: 10px;
  margin: 20px auto;
  max-width: 600px;
}

.link-about {
  color: lightblue;
  text-align: center;
  cursor: pointer;
  margin-top: 20px;
}</style></head> 
 <body style="background-color: black; color: white;"> 
  <header> 
   <div class="logo-container"> 
    <img src="icons/logo.png" alt="HOMOS Logo" class="logo-img"> 
    <h1>HOMOS Wallet</h1> 
   </div> <button onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button> 
  </header> 
  <main> <!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ --> 
   <div id="auth-section"> 
    <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2> 
    <input type="email" id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"> 
    <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"> <button onclick="login()">Ø¯Ø®ÙˆÙ„ / ØªØ³Ø¬ÙŠÙ„</button> 
    <p><a href="#" onclick="forgotPassword()">Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ</a></p> 
    <p id="error-message"></p> 
    <p class="link-about" onclick="toggleAbout()">Ù…Ù† Ù†Ø­Ù† / ÙƒÙŠÙÙŠØ© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…ØŸ</p> 
    <div id="about-section" style="display: none;"> 
     <h3>Ù…Ù† Ù†Ø­Ù†</h3> 
     <p>Ù†Ø­Ù† Ù…Ø­ÙØ¸Ø© Ø±Ù‚Ù…ÙŠØ© ØªÙ‚Ø¯Ù… Ø®Ø¯Ù…Ø§Øª ØªØ­ÙˆÙŠÙ„ ÙˆØ³Ø­Ø¨ ÙˆØ´Ø­Ù† Ø¨Ø§Ù‚Ø§Øª ÙÙƒØ©.</p> 
     <h3>ÙƒÙŠÙÙŠØ© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…</h3> 
     <p>Ø³Ø¬Ù‘Ù„ØŒ Ø§Ø®ØªØ± Ø§Ù„Ø®Ø¯Ù…Ø©ØŒ ÙˆØ£Ø±Ø³Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ ÙˆØ³ÙŠØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨.</p> 
    </div> 
   </div> <!-- Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ --> 
   <div id="wallet-section" style="display: none;"> 
    <h2>Ø£Ù‡Ù„Ø§Ù‹ <span id="user-email"></span></h2> 
    <p>Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ: <span id="balance">0</span> Ø¬Ù†ÙŠÙ‡ <button id="toggle-balance" onclick="toggleBalance()">Ø¥Ø®ÙØ§Ø¡</button> </p> 
    <p id="last-operation" style="font-size: 0.9em; color: gray;"></p> <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª --> 
    <div class="button-grid"> <button onclick="showSection('deposit-section')">ğŸ’° Ø¥ÙŠØ¯Ø§Ø¹</button> <button onclick="showSection('withdraw-section')">ğŸ’¸ Ø³Ø­Ø¨</button> <button onclick="showSection('transfer-section')">ğŸ” ØªØ­ÙˆÙŠÙ„</button> <button onclick="showSection('support-section')">ğŸ“ Ø§Ù„Ø¯Ø¹Ù…</button> <button onclick="showUserHistory()">ğŸ“‹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</button> <button onclick="showSection('fakka-section')">ğŸ“± ÙÙƒØ©</button> 
    </div> <!-- Ù‚Ø³Ù… Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹ --> 
    <div id="deposit-section" class="operation-section" style="display: none;"> 
     <h3>Ø¥ÙŠØ¯Ø§Ø¹ Ø±ØµÙŠØ¯</h3> 
     <p>Ø§Ø±Ø³Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ù‚Ù…: <span id="deposit-phone">01014879247</span> <button onclick="copyPhone()">Ù†Ø³Ø®</button></p> 
     <input type="number" id="deposit-amount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø­ÙˆÙ‘Ù„"> 
     <input type="text" id="sender-phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø³Ù„"> 
     <input type="file" id="deposit-proof" accept="image/*"> <button onclick="confirmDeposit()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹</button> 
    </div> <!-- Ù‚Ø³Ù… Ø§Ù„Ø³Ø­Ø¨ --> 
    <div id="withdraw-section" class="operation-section" style="display: none;"> 
     <h3>Ø³Ø­Ø¨ Ø±ØµÙŠØ¯</h3> 
     <input type="text" id="withdraw-phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø³Ø­Ø¨"> 
     <input type="number" id="withdraw-amount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº"> <button onclick="confirmWithdraw()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø³Ø­Ø¨</button> 
    </div> <!-- Ù‚Ø³Ù… Ø§Ù„ØªØ­ÙˆÙŠÙ„ --> 
    <div id="transfer-section" class="operation-section" style="display: none;"> 
     <h3>ØªØ­ÙˆÙŠÙ„ Ø±ØµÙŠØ¯</h3> 
     <input type="email" id="transfer-email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ù…Ø³ØªÙ„Ù…"> 
     <input type="number" id="transfer-amount" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº"> <button onclick="confirmTransfer()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ­ÙˆÙŠÙ„</button> 
    </div> <!-- Ù‚Ø³Ù… Ø§Ù„Ø¯Ø¹Ù… --> 
    <div id="support-section" class="operation-section" style="display: none;"> 
     <h3>Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ</h3> 
     <p><a href="mailto:homoswallet@gmail.com">homoswallet@gmail.com</a></p> 
     <p><a href="https://wa.me/201012265953" target="_blank">ÙˆØ§ØªØ³Ø§Ø¨: +201012265953</a></p> 
     <p><a href="tel:+20402403621">Ø£Ø±Ø¶ÙŠ: +20402403621</a></p> 
     <p><a href="tel:+201014879247">Ù…ÙˆØ¨Ø§ÙŠÙ„: +201014879247</a></p> 
    </div> <!-- Ù‚Ø³Ù… ÙÙƒØ© --> 
    <div id="fakka-section" class="operation-section" style="display: none;"> 
     <h3>Ø´Ø­Ù† Ø¨Ø§Ù‚Ø§Øª Ø§Ù„ÙÙƒØ©</h3> <select id="fakka-package"> <option value="13">Ø¨Ø§Ù‚Ø© ÙÙƒØ© 13 Ø¬Ù†ÙŠÙ‡</option> <option value="16.5">Ø¨Ø§Ù‚Ø© ÙÙƒØ© 16.5 Ø¬Ù†ÙŠÙ‡</option> <option value="19.5">Ø¨Ø§Ù‚Ø© ÙÙƒØ© 19.5 Ø¬Ù†ÙŠÙ‡</option> <option value="26">Ø¨Ø§Ù‚Ø© ÙÙƒØ© 26 Ø¬Ù†ÙŠÙ‡</option> </select> 
     <input type="text" id="fakka-number" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø´Ø­Ù†"> <button onclick="confirmFakka()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø´Ø­Ù†</button> 
    </div> 
   </div> 
  </main> 
  <div id="footer-marquee"> <marquee behavior="scroll" direction="right">
     Ù†Ø¹Ù…Ù„ Ø¹Ù„Ù‰ ØªØ·ÙˆÙŠØ± HOMOS Wallet Ù„ØªÙ‚Ø¯ÙŠÙ… ÙƒÙ„ Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø´Ø­Ù† ÙˆØ§Ù„ØªØ­ÙˆÙŠÙ„ ÙˆØ§Ù„Ø³Ø­Ø¨ â€” Ø´ÙƒØ±Ù‹Ø§ Ù„Ø«Ù‚ØªÙƒÙ…! 
   </marquee> 
  </div> 
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script> 
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script> 
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script> 
  <script src="app.js"></script> 
 
<script type="text/javascript" id="dcoder_script">// ØªÙ‡ÙŠØ¦Ø© Firebase
const firebaseConfig = {
  apiKey: "AIzaSyCWyQfMmzp41jTYV4GXFViV2wMMTIiP8XU",
  authDomain: "wallet-52a17.firebaseapp.com",
  projectId: "wallet-52a17",
  storageBucket: "wallet-52a17.appspot.com",
  messagingSenderId: "440517088889",
  appId: "1:440517088889:web:a862ab37106851c66066a8",
  measurementId: "G-28Z0S2BGEV"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

let currentVisibleSection = null;
function showSection(sectionId) {
  if (currentVisibleSection === sectionId) {
    document.getElementById(sectionId).style.display = "none";
    currentVisibleSection = null;
  } else {
    ["deposit-section", "withdraw-section", "transfer-section", "support-section"].forEach(id => {
      document.getElementById(id).style.display = "none";
    });
    document.getElementById(sectionId).style.display = "block";
    currentVisibleSection = sectionId;
  }
}

let balanceVisible = true;
function toggleBalance() {
  const balanceEl = document.getElementById("balance");
  const toggleBtn = document.getElementById("toggle-balance");
  if (balanceVisible) {
    balanceEl.innerText = "â€¢â€¢â€¢â€¢â€¢";
    toggleBtn.innerText = "Ø¥Ø¸Ù‡Ø§Ø±";
  } else {
    const userEmail = auth.currentUser.email;
    db.collection("wallets").doc(userEmail).get().then(doc => {
      if (doc.exists) {
        balanceEl.innerText = doc.data().balance.toFixed(2);
      }
    });
    toggleBtn.innerText = "Ø¥Ø®ÙØ§Ø¡";
  }
  balanceVisible = !balanceVisible;
}

function forgotPassword() {
  const email = document.getElementById("email").value.trim();
  if (!email) {
    alert("Ø§ÙƒØªØ¨ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø£ÙˆÙ„ Ø¹Ø´Ø§Ù† Ù†Ù‚Ø¯Ø± Ù†Ø¨Ø¹ØªÙ‡ Ù„Ùƒ!");
    return;
  }
  auth.sendPasswordResetEmail(email)
    .then(() => alert("Ø¨Ø¹ØªÙ†Ø§Ù„Ùƒ Ø±Ø³Ø§Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ØŒ Ø±Ø§Ø¬Ø¹Ù‡Ø§ ÙˆØºÙŠÙ‘Ø± Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯."))
    .catch(err => alert("Ø­ØµÙ„ Ø®Ø·Ø£: " + err.message));
}

function login() {
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value.trim();

  if (!email.includes("@") || password.length < 6) {
    alert("Ø§ÙƒØªØ¨ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØµØ­ÙŠØ­ ÙˆÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø£ÙƒØªØ± Ù…Ù† 6 Ø­Ø±ÙˆÙ.");
    return;
  }

  auth.signInWithEmailAndPassword(email, password)
    .then(() => afterLogin(email))
    .catch((error) => {
      if (error.code === 'auth/user-not-found' || error.code === 'auth/invalid-login-credentials') {
        auth.createUserWithEmailAndPassword(email, password)
          .then(() => {
            alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯! Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„...");
            afterLogin(email);
          })
          .catch((signupError) => {
            document.getElementById("error-message").innerText = "Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨: " + signupError.message;
          });
      } else {
        document.getElementById("error-message").innerText = "Ø®Ø·Ø£: " + error.message;
      }
    });
}

function afterLogin(email) {
  document.getElementById("auth-section").style.display = "none";
  document.getElementById("wallet-section").style.display = "block";
  document.getElementById("user-email").innerText = email;

  if (email === "ahmedfouad01278837444@gmail.com") {
    document.getElementById("admin-section").style.display = "block";
    loadUsers();
  }

  const userDoc = db.collection("wallets").doc(email);
  userDoc.get().then(doc => {
    if (!doc.exists) {
      userDoc.set({ balance: 0, history: [] });
    } else {
      const data = doc.data();
      document.getElementById("balance").innerText = data.balance.toFixed(2);

      const history = data.history;
      if (history && history.length > 0) {
        const last = history[history.length - 1];
        document.getElementById("last-operation").innerText =
          `Ø¢Ø®Ø± Ø¹Ù…Ù„ÙŠØ©: ${last.type} Ø¨Ù‚ÙŠÙ…Ø© ${last.amount} Ø¬Ù†ÙŠÙ‡ Ø¨ØªØ§Ø±ÙŠØ® ${last.date.slice(0, 10)}`;
      }
    }
  });
}

auth.onAuthStateChanged((user) => {
  if (user) {
    afterLogin(user.email);
  } else {
    document.getElementById("auth-section").style.display = "block";
    document.getElementById("wallet-section").style.display = "none";
  }
});

function logout() {
  auth.signOut().then(() => {
    location.reload();
  });
}

function copyPhone() {
  navigator.clipboard.writeText("01014879247");
  alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ù‚Ù…!");
}

function confirmDeposit() {
  const amount = parseFloat(document.getElementById("deposit-amount").value);
  const senderPhone = document.getElementById("sender-phone").value.trim();
  const userEmail = auth.currentUser.email;

  if (!amount || !senderPhone) {
    alert("Ù…Ø­ØªØ§Ø¬ ØªÙƒØªØ¨ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!");
    return;
  }

  if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ Ù‡ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„Ù‡Ø§ Ù„Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©.")) {
    let message = `Ø¹Ù…Ù„ÙŠØ© Ø¥ÙŠØ¯Ø§Ø¹ Ø¬Ø¯ÙŠØ¯Ø©\nØ§Ù„Ø¨Ø±ÙŠØ¯: ${userEmail}\nÙ…Ø¨Ù„Øº Ø§Ù„ØªØ­ÙˆÙŠÙ„: ${amount} Ø¬Ù†ÙŠÙ‡\nØ±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ Ø§Ù„Ù„ÙŠ Ø­ÙˆÙ„Øª Ù…Ù†Ù‡: ${senderPhone}`;
    let whatsappURL = `https://wa.me/201016553764?text=${encodeURIComponent(message)}`;
    window.open(whatsappURL, '_blank');
    alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒØŒ Ø³ÙŠØªÙ… Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡Ø§ ÙˆØ§Ø¶Ø§ÙØ© Ø§Ù„Ø±ØµÙŠØ¯ Ù‚Ø±ÙŠØ¨Ø§Ù‹.");
  }
}

function confirmWithdraw() {
  const withdrawPhone = document.getElementById("withdraw-phone").value.trim();
  const amount = parseFloat(document.getElementById("withdraw-amount").value);
  const userEmail = auth.currentUser.email;

  if (!withdrawPhone || !amount) {
    alert("Ù…Ø­ØªØ§Ø¬ ØªÙƒØªØ¨ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!");
    return;
  }

  if (amount < 5) {
    alert("Ø£Ù‚Ù„ Ù…Ø¨Ù„Øº Ù„Ù„Ø³Ø­Ø¨ Ù‡Ùˆ 5 Ø¬Ù†ÙŠÙ‡!");
    return;
  }

  const commission = Math.max(amount * 0.015, 3);
  const finalAmount = amount - commission;

  const userDoc = db.collection("wallets").doc(userEmail);
  userDoc.get().then(doc => {
    if (doc.exists && doc.data().balance >= amount) {
      userDoc.update({
        balance: firebase.firestore.FieldValue.increment(-amount),
        history: firebase.firestore.FieldValue.arrayUnion({
          type: 'Ø³Ø­Ø¨',
          amount: amount,
          date: new Date().toISOString()
        })
      }).then(() => {
        let message = `Ø·Ù„Ø¨ Ø³Ø­Ø¨ Ø¬Ø¯ÙŠØ¯\nØ§Ù„Ø¨Ø±ÙŠØ¯: ${userEmail}\nÙ…Ø¨Ù„Øº Ø§Ù„Ø³Ø­Ø¨: ${amount} Ø¬Ù†ÙŠÙ‡\nØ±Ù‚Ù… Ø§Ù„Ø³Ø­Ø¨: ${withdrawPhone}\nØ§Ù„Ù…Ø¨Ù„Øº Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…: ${finalAmount.toFixed(2)} Ø¬Ù†ÙŠÙ‡`;
        let whatsappURL = `https://wa.me/201016553764?text=${encodeURIComponent(message)}`;
        window.location.href = whatsappURL;
      });
    } else {
      alert("Ù…Ø¹ÙƒØ´ÙŠ ÙÙ„ÙˆØ³!");
    }
  });
}

function confirmTransfer() {
  const recipientEmail = document.getElementById("transfer-email").value.trim();
  const amount = parseFloat(document.getElementById("transfer-amount").value);
  const senderEmail = auth.currentUser.email;

  if (!recipientEmail || !amount) {
    alert("Ù…Ø­ØªØ§Ø¬ ØªÙƒØªØ¨ Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙˆØ§Ù„Ù…Ø¨Ù„Øº!");
    return;
  }

  const totalDeduct = amount + 1;
  const senderDoc = db.collection("wallets").doc(senderEmail);
  const recipientDoc = db.collection("wallets").doc(recipientEmail);

  senderDoc.get().then(senderSnapshot => {
    if (senderSnapshot.exists && senderSnapshot.data().balance >= totalDeduct) {
      recipientDoc.get().then(recipientSnapshot => {
        if (recipientSnapshot.exists) {
          recipientDoc.update({
            balance: firebase.firestore.FieldValue.increment(amount),
            history: firebase.firestore.FieldValue.arrayUnion({
              type: 'Ø§Ø³ØªÙ„Ø§Ù… ØªØ­ÙˆÙŠÙ„',
              amount: amount,
              from: senderEmail,
              date: new Date().toISOString()
            })
          });
        } else {
          recipientDoc.set({
            balance: amount,
            history: [{
              type: 'Ø§Ø³ØªÙ„Ø§Ù… ØªØ­ÙˆÙŠÙ„',
              amount: amount,
              from: senderEmail,
              date: new Date().toISOString()
            }]
          });
        }

        senderDoc.update({
          balance: firebase.firestore.FieldValue.increment(-totalDeduct),
          history: firebase.firestore.FieldValue.arrayUnion({
            type: 'ØªØ­ÙˆÙŠÙ„',
            amount: amount,
            to: recipientEmail,
            date: new Date().toISOString()
          })
        }).then(() => {
          alert("ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!");
          location.reload();
        });
      });
    } else {
      alert("Ø±ØµÙŠØ¯Ùƒ Ù…Ø´ ÙƒÙØ§ÙŠØ©!");
    }
  });
}

function addBalance() {
  const email = document.getElementById("target-email").value.trim();
  const amount = parseFloat(document.getElementById("add-amount").value);

  if (!email || !amount) {
    alert("Ù…Ø­ØªØ§Ø¬ ØªÙƒØªØ¨ Ø§Ù„Ø¨Ø±ÙŠØ¯ ÙˆØ§Ù„Ù…Ø¨Ù„Øº!");
    return;
  }

  const userDoc = db.collection("wallets").doc(email);
  userDoc.get().then(doc => {
    if (doc.exists) {
      userDoc.update({
        balance: firebase.firestore.FieldValue.increment(amount),
        history: firebase.firestore.FieldValue.arrayUnion({
          type: 'Ø§Ø¶Ø§ÙØ© Ù…Ø¯ÙŠØ±',
          amount: amount,
          date: new Date().toISOString()
        })
      }).then(() => {
        alert("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±ØµÙŠØ¯ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…!");
      });
    } else {
      userDoc.set({
        balance: amount,
        history: [{
          type: 'Ø§Ø¶Ø§ÙØ© Ù…Ø¯ÙŠØ±',
          amount: amount,
          date: new Date().toISOString()
        }]
      }).then(() => {
        alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØ§Ø¶Ø§ÙØ© Ø§Ù„Ø±ØµÙŠØ¯!");
      });
    }
  });
}

function showUserHistory() {
  const email = auth.currentUser.email;
  db.collection("wallets").doc(email).get().then(doc => {
    if (doc.exists) {
      const history = doc.data().history || [];
      let output = `Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ù„Ù€ ${email}:\n\n`;
      history.forEach(record => {
        output += `${record.date} - ${record.type} - Ù…Ø¨Ù„Øº: ${record.amount} Ø¬Ù†ÙŠÙ‡\n`;
        if (record.to) output += `--> Ø¥Ù„Ù‰: ${record.to}\n`;
        if (record.from) output += `--> Ù…Ù†: ${record.from}\n`;
      });
      alert(output);
    }
  });
}

function loadUsers() {
  const usersList = document.getElementById("users-list");
  usersList.innerHTML = "";
  db.collection("wallets").get().then(snapshot => {
    snapshot.forEach(doc => {
      const user = doc.id;
      const button = document.createElement("button");
      button.innerText = `Ø´ÙˆÙ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ù„Ù€ ${user}`;
      button.onclick = () => showUserHistory(user);
      usersList.appendChild(button);
    });
  });
}

function confirmFakka() {
  const selectedPackage = parseFloat(document.getElementById("fakka-package").value);
  const fakkaNumber = document.getElementById("fakka-number").value.trim();
  const userEmail = auth.currentUser.email;

  if (!selectedPackage || !fakkaNumber) {
    alert("Ù…Ø­ØªØ§Ø¬ ØªØ®ØªØ§Ø± Ø§Ù„Ø¨Ø§Ù‚Ø© ÙˆØªÙƒØªØ¨ Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„!");
    return;
  }

  const totalCost = selectedPackage + 2.5;

  if (confirm(`Ù‡ÙŠØªÙ… Ø®ØµÙ… ${totalCost.toFixed(2)} Ø¬Ù†ÙŠÙ‡ Ù…Ù† Ø±ØµÙŠØ¯Ùƒ. ØªØ£ÙƒÙŠØ¯ØŸ`)) {
    const userDoc = db.collection("wallets").doc(userEmail);
    userDoc.get().then(doc => {
      if (doc.exists && doc.data().balance >= totalCost) {
        userDoc.update({
          balance: firebase.firestore.FieldValue.increment(-totalCost),
          history: firebase.firestore.FieldValue.arrayUnion({
            type: 'Ø´Ø­Ù† ÙÙƒØ©',
            amount: totalCost,
            number: fakkaNumber,
            package: selectedPackage,
            date: new Date().toISOString()
          })
        }).then(() => {
          const msg = `Ø·Ù„Ø¨ Ø´Ø­Ù† Ø¨Ø§Ù‚Ø© ÙÙƒØ©\nØ§Ù„Ø¨Ø±ÙŠØ¯: ${userEmail}\nØ§Ù„Ø¨Ø§Ù‚Ø©: ${selectedPackage} Ø¬Ù†ÙŠÙ‡\nØ§Ù„Ø±Ù‚Ù…: ${fakkaNumber}\nØ§Ù„Ù…Ø¨Ù„Øº Ø¨Ø¹Ø¯ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©: ${totalCost.toFixed(2)} Ø¬Ù†ÙŠÙ‡`;
          const wa = `https://wa.me/201016553764?text=${encodeURIComponent(msg)}`;
          window.location.href = wa;
        });
      } else {
        alert("Ø±ØµÙŠØ¯Ùƒ Ù…Ø´ ÙƒØ§ÙÙŠ!");
      }
    });
  }
}
function toggleHowToUse() {
  const section = document.getElementById('how-to-use-section');
  if (section.style.display === 'none') {
    section.style.display = 'block';
  } else {
    section.style.display = 'none';
  }
}</script></body></html>